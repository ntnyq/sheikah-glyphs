// ==UserScript==
// @name         Sheikah Glyphs
// @homepageURL  https://github.com/antfu/sheikah-glyphs
// @supportURL   https://github.com/antfu/sheikah-glyphs
// @namespace    sheikah-glyphs
// @version      0.0.0
// @description  Replace all available chars to Sheikah Glyphs.
// @author       ntnyq
// @license      MIT
// @match        http*://*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=zelda.com
// @grant        none
// ==/UserScript==

;(function () {
  'use strict'

  const doc = document
  const SELECTOR =
    'body *:not(script):not(style):not(noscript):not(pre):not(code):not(input):not(textarea):not([contenteditable="true"]):not(.sheikah-glyph):not(.sheikah-glyphs-rendered)'
  // cSpell: disable-next-line
  const SHEIKAH_GLYPHS = '01234567890abcdefghigklmnopqrstuvwxyz-!.?'
  const CSS = `
    @font-face {
      font-family: "SheikahGlyphs";
      src: url("data:font/ttf;charset=utf-8;base64,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AAA1IREhNzMXEQcjIREXESU1MxUBd/6Jffp9ffoCcX38lX19AnF9ff2PfQNrff2P+n19AAADAAAAAANrA2sABgANABEAABE3IRchESMFByEnIREzBSM1M30CcX39En0Da339j30C7n3+iX19Au59ff4MfX19AfT6fQAAAAADAAAAAANrA2sAAwANABEAADMnETcBByMnETczFyERJSM1M319fQLuffp9ffp9/okBd319fQJxff0SfX0CcX19/Y/6fQAAAAADAAAAAANrA2sABgANABEAACERITchFxEFESE1IRcRITUzFQLu/RJ9AnF9/gz+iQF3ff4MfQLufX39j30Bd319/ol9fQAAAAADAAAAAANrA2sAAwANABEAABE3IRcBJzU3IRcVBxEhEzUzFX0CcX39En19AnF9ff2P+n0C7n19/RJ9+n19+n0Bd/6JfX0AAAADAAAAAANrA2sABgANABEAADMnETchFyEBIxE3IRUhASM1M319fQJxff0SAXd9fQF3/okBd319fQJxfX39EgF3fX3+iX0AAAAFAAAAAANrA2sACQANABEAFQAZAAABEQcjJyERNzMXJTMVIxUzFSMlMxUjFTMVIwH0ffp9AXd9+n38lX19fX0C7n19fX0C7v2PfX0CcX19fX36fX19+n0AAgAAAAADawNrABIAFgAAExEhESERMxUjJxE3IRcRByEnEQUzFSN9AnH+ifr6fX0Bd319/Y99AfR9fQNr/RICcf6JfX0Bd319/Y99fQJxfX0AAAAABgAAAAADawNrAAMACgARABUAHwAjAAARMxUjJRUHIzUzNSEVMxUjJzU7ARUjASc1NyEXFQc1IRchFSF9fQF3ffr6AXf6+n36fX39j319AnF9ff2PfQF3/okDa319+n19+vp9ffp9/RJ9fX19fX36fX0AAAACAAAAAANrA2sAFQArAAATMxcVByMVMxcVByMnMzUjJzU3MzUjJTMXIxUzFxUHIxUzByMnNTczNSMnNX19fX19fX19fX36fX19ffoCcX19+n19fX36fX19fX19fQNrfX19fX19fX19fX19fX19fX19fX19fX19fX19AAAAAwAAAAADawNrAAYAEAAUAAATIRcRBxEhFSEXEQchJyERIRUhFSF9AnF9ff0SAfR9ff6JfQH0/gwBd/6JA2t9/Y99Au59ff6JfX0Bd319AAAFAAAAAANrA2sAAwANABEAHgArAAARMxUjJTMXFSM1IxUjNSUzFSMFMxUzFxUHIyczNSMnJRUHIxUzByMnNTczNX19AXd9fX19fQH0fX39En19fX19ffp9fQNrfX36fX19fX0Da319ffr6+vp9fX36fX19fX19+vp9fX19fX36AAIAAAAAA2sDawAJAB8AABMhFxUjNSEVIzURMxUzETczFxEzNTMVByMnESMRByMnfQJxfX39j319fX19fX19fX19fX19fQNrffr6+vr+ifoBd319/on6+n19AXf+iX19AAEAAAAAA2sDawAYAAA1IREjFQcjJxE3IRcRBxEhETM1NzMXEQchAfR9fX19fQJxfX39j319fX19/ol9AXd9fX0Bd319/Y99Au7+iX19ff6JfQAAAAYAAAAAA2sDawADAAcACwAPABkAIwAAETMVIzczFSM3MxUjNzMVIwUhFxEHESERJxEXNzMXFSM1IxUjfX36fX36fX36fX39jwJxfX39j336fX19fX19A2t9fX19fX19fX3+iX0B9P4MfQF3+n19+vr6AAAABQAAAAADawNrABUAGQAdACEAJQAAEzMXETMRNzMXFSM1IxEHIycRIxUjNREzFSMlMxUjBTMVIyUzFSN9fX19fX19fX19fX19fX19Au59ff0SfX0C7n19A2t9/Y8CcX19+vr9j319AnH6+v6JfX19fX19fQAEAAAAAANrA2sADwAWABoAHgAAExUzNTchFxEHESEVByMnNQUzEQchJyElFSM1IRUjNX19fQF3fX3+iX19fQH0fX3+iX0B9P6JfQF3fQNr+n19ff2PfQLufX19fX3+DH19+n19fX0AAAYAAAAAA2sDawADAAcACwAPABMAFwAAETcRJxMzESMTMxEjExcRBwEzESMTMxEjfX36fX36fX36fX3+DH19+n19Au59/JV9Au7+iQF3/okBd339j30Bd/6JAXf+iQAAAAQAAAAAA2sDawAMABAAFAAYAAATETMRNyEXIREHIycRBSEVIRUhFSEFIQchfX19AXd9/gx9fX0B9AF3/okBd/6J/gwDa339jwNr/gwBd319/ol9fQF3fX19fX19AAAAAAYAAAAAA2sDawADAAoAEQAVABkAHQAAEyEXIRUzFxUjNSMlMxUjFSM1BTMVIyUzFSMFIQchfQJxffyV+n19+gJx+vp9/gx9fQLufX39EgNrff2PA2t9fX36+n19+vp9fX19fX0AAAAAAgAAAAADawNrAAkAGQAAEzMXFQcjNTM1IyUzEQchFSERFxEHISc1NyF9fX19+vr6AfR9ff6JAnF9ff2PfX0BdwNrfX19fX19/gx9fQLuff2PfX19fQAAAAUAAAAAA2sDawAVABkAHQAhACUAABMVMxcRMxE3MzUXFQcjEQcjJxEjJzU3MxUjNzMVIwEzESclMxUHfX19fX19fX19fX19fX36fX36fX3+DH19Au59fQNr+n3+iQF3ffp9fX3+iX19AXd9fX19fX3+if6Jffr6fQAAAAAEAAAAAANrA2sACQANABEAFQAAExEhERcRByEnETchFSEVIRUhFSEVIX0CcX19/Y99+gF3/okBd/6JAXf+iQNr/RIC7n39j319AnF9fX19fX0AAAAGAAAAAANrA2sAAwANABEAFQAZAB0AABEzFSMlMxUHIREnETchJzMVIyUXEQcBMxEjEzMRI319AfR9ff6JfX0Bd/p9fQH0fX3+DH19+n19A2t9ffp9/gx9AXd9+n19ff2PfQF3/okBd/6JAAAEAAAAAANrA2sAFQAlACkALQAAEzMXFTM1NzMXFSM1IxUHIyc1IxUjNREzFxUzNTczFSMVByMnNSMVMxUjJTMVI319fX19fX19fX19fX19+n19ffr6fX19+n19Au59fQNrfX19fX36+n19fX36+v6JfX19fX19fX19fX19fQAAAAQAAAAAA2sDawAJABMAFwAbAAABFSMRMxUjJxE3ITMXEQcjNTMRIwchFSEVIRUhAXf6+vp9fQF3+n19+vr6+gF3/okBd/6JA2t9/Y99fQJxfX39j319AnF9fX19AAAAAAMAAAAAA2sDawAVABkAHQAAExEzNTczFxUzERcRByMnNSMVByMnETchFSEDIQchfX19fX19fX19fX19fX36AXf+ifoDa339jwNr/gx9fX19AfR9/ol9fX19fX0Bd319/Y99AAAFAAAAAANrA2sACQANABEAFQAZAAATIRUhESEVIScRJRcRIwEzFSM3MxUjASEHIX0B9P4MAfT+DH0C7n19/gx9ffp9ff4MA2t9/Y8Da33+iX19AXd9ff4MAXd9fX3+iX0AAAAAAwAAAAADawNrAA8AEwAXAAATIRcVByERIxE3ITUhEScRATMRIxMzFQd9AnF9ff6JfX0Bd/2PfQH0fX36fX0Da319ff4MAfR9ff0SfQJx/on+iQF3+n0AAAIAAAAAA2sDawAPABkAABMzFxEzETczFyMRByMnESMVMxEhETMRByEnfX19fX19ffp9fX36fQJxfX39j30Da33+iQF3fX3+iX19AXd9/gwB9P4MfX0AAAAEAAAAAANrA2sADwATABcAJwAAEzMXFTM1NzMXIxUHIyc1IxUzESMBMxEjBTM1NzMXFTMHIyc1IxUHI319fX19fX36fX19+n19Au59ff0S+n19ffp9fX19fX0Da319fX19fX19fX3+iQF3/ol9fX19fX19fX19AAAEAAAAAANrA2sABgANABEAFQAAEzMXESMRIyURMwcjJxEzFxEjATMRJ319fX36AnH6fX19+n19/RJ9fQNrff0SAu59/RJ9fQLuff4MAXf9j30AAAACAAAAAANrA2sADAAZAAATIRcRByMnNTMVMxEhASEnETczFxUjNSMRIX0CcX19fX19ff0SAu79j319fX19fQLuA2t9/ol9ffr6AXf9En0Bd319+vr+iQAAAgAAAAADawNrABIAFgAAExEhESERMxUjJxE3IRcRByEnEQUzFSN9AnH+ifr6fX0Bd319/Y99AfR9fQNr/RICcf6JfX0Bd319/Y99fQJxfX0AAAAABgAAAAADawNrAAMACgARABUAHwAjAAARMxUjJRUHIzUzNSEVMxUjJzU7ARUjASc1NyEXFQc1IRchFSF9fQF3ffr6AXf6+n36fX39j319AnF9ff2PfQF3/okDa319+n19+vp9ffp9/RJ9fX19fX36fX0AAAACAAAAAANrA2sAFQArAAATMxcVByMVMxcVByMnMzUjJzU3MzUjJTMXIxUzFxUHIxUzByMnNTczNSMnNX19fX19fX19fX36fX19ffoCcX19+n19fX36fX19fX19fQNrfX19fX19fX19fX19fX19fX19fX19fX19fX19AAAAAwAAAAADawNrAAYAEAAUAAATIRcRBxEhFSEXEQchJyERIRUhFSF9AnF9ff0SAfR9ff6JfQH0/gwBd/6JA2t9/Y99Au59ff6JfX0Bd319AAAFAAAAAANrA2sAAwANABEAHgArAAARMxUjJTMXFSM1IxUjNSUzFSMFMxUzFxUHIyczNSMnJRUHIxUzByMnNTczNX19AXd9fX19fQH0fX39En19fX19ffp9fQNrfX36fX19fX0Da319ffr6+vp9fX36fX19fX19+vp9fX19fX36AAIAAAAAA2sDawAJAB8AABMhFxUjNSEVIzURMxUzETczFxEzNTMVByMnESMRByMnfQJxfX39j319fX19fX19fX19fX19fQNrffr6+vr+ifoBd319/on6+n19AXf+iX19AAEAAAAAA2sDawAYAAA1IREjFQcjJxE3IRcRBxEhETM1NzMXEQchAfR9fX19fQJxfX39j319fX19/ol9AXd9fX0Bd319/Y99Au7+iX19ff6JfQAAAAYAAAAAA2sDawADAAcACwAPABkAIwAAETMVIzczFSM3MxUjNzMVIwUhFxEHESERJxEXNzMXFSM1IxUjfX36fX36fX36fX39jwJxfX39j336fX19fX19A2t9fX19fX19fX3+iX0B9P4MfQF3+n19+vr6AAAABQAAAAADawNrABUAGQAdACEAJQAAEzMXETMRNzMXFSM1IxEHIycRIxUjNREzFSMlMxUjBTMVIyUzFSN9fX19fX19fX19fX19fX19Au59ff0SfX0C7n19A2t9/Y8CcX19+vr9j319AnH6+v6JfX19fX19fQAEAAAAAANrA2sADwAWABoAHgAAExUzNTchFxEHESEVByMnNQUzEQchJyElFSM1IRUjNX19fQF3fX3+iX19fQH0fX3+iX0B9P6JfQF3fQNr+n19ff2PfQLufX19fX3+DH19+n19fX0AAAYAAAAAA2sDawADAAcACwAPABMAFwAAETcRJxMzESMTMxEjExcRBwEzESMTMxEjfX36fX36fX36fX3+DH19+n19Au59/JV9Au7+iQF3/okBd339j30Bd/6JAXf+iQAAAAQAAAAAA2sDawAMABAAFAAYAAATETMRNyEXIREHIycRBSEVIRUhFSEFIQchfX19AXd9/gx9fX0B9AF3/okBd/6J/gwDa339jwNr/gwBd319/ol9fQF3fX19fX19AAAAAAYAAAAAA2sDawADAAoAEQAVABkAHQAAEyEXIRUzFxUjNSMlMxUjFSM1BTMVIyUzFSMFIQchfQJxffyV+n19+gJx+vp9/gx9fQLufX39EgNrff2PA2t9fX36+n19+vp9fX19fX0AAAAAAgAAAAADawNrAAkAGQAAEzMXFQcjNTM1IyUzEQchFSERFxEHISc1NyF9fX19+vr6AfR9ff6JAnF9ff2PfX0BdwNrfX19fX19/gx9fQLuff2PfX19fQAAAAUAAAAAA2sDawAVABkAHQAhACUAABMVMxcRMxE3MzUXFQcjEQcjJxEjJzU3MxUjNzMVIwEzESclMxUHfX19fX19fX19fX19fX36fX36fX3+DH19Au59fQNr+n3+iQF3ffp9fX3+iX19AXd9fX19fX3+if6Jffr6fQAAAAAEAAAAAANrA2sACQANABEAFQAAExEhERcRByEnETchFSEVIRUhFSEVIX0CcX19/Y99+gF3/okBd/6JAXf+iQNr/RIC7n39j319AnF9fX19fX0AAAAGAAAAAANrA2sAAwANABEAFQAZAB0AABEzFSMlMxUHIREnETchJzMVIyUXEQcBMxEjEzMRI319AfR9ff6JfX0Bd/p9fQH0fX3+DH19+n19A2t9ffp9/gx9AXd9+n19ff2PfQF3/okBd/6JAAAEAAAAAANrA2sAFQAlACkALQAAEzMXFTM1NzMXFSM1IxUHIyc1IxUjNREzFxUzNTczFSMVByMnNSMVMxUjJTMVI319fX19fX19fX19fX19+n19ffr6fX19+n19Au59fQNrfX19fX36+n19fX36+v6JfX19fX19fX19fX19fQAAAAQAAAAAA2sDawAJABMAFwAbAAABFSMRMxUjJxE3ITMXEQcjNTMRIwchFSEVIRUhAXf6+vp9fQF3+n19+vr6+gF3/okBd/6JA2t9/Y99fQJxfX39j319AnF9fX19AAAAAAMAAAAAA2sDawAVABkAHQAAExEzNTczFxUzERcRByMnNSMVByMnETchFSEDIQchfX19fX19fX19fX19fX36AXf+ifoDa339jwNr/gx9fX19AfR9/ol9fX19fX0Bd319/Y99AAAFAAAAAANrA2sACQANABEAFQAZAAATIRUhESEVIScRJRcRIwEzFSM3MxUjASEHIX0B9P4MAfT+DH0C7n19/gx9ffp9ff4MA2t9/Y8Da33+iX19AXd9ff4MAXd9fX3+iX0AAAAAAwAAAAADawNrAA8AEwAXAAATIRcVByERIxE3ITUhEScRATMRIxMzFQd9AnF9ff6JfX0Bd/2PfQH0fX36fX0Da319ff4MAfR9ff0SfQJx/on+iQF3+n0AAAIAAAAAA2sDawAPABkAABMzFxEzETczFyMRByMnESMVMxEhETMRByEnfX19fX19ffp9fX36fQJxfX39j30Da33+iQF3fX3+iX19AXd9/gwB9P4MfX0AAAAEAAAAAANrA2sADwATABcAJwAAEzMXFTM1NzMXIxUHIyc1IxUzESMBMxEjBTM1NzMXFTMHIyc1IxUHI319fX19fX36fX19+n19Au59ff0S+n19ffp9fX19fX0Da319fX19fX19fX3+iQF3/ol9fX19fX19fX19AAAEAAAAAANrA2sABgANABEAFQAAEzMXESMRIyURMwcjJxEzFxEjATMRJ319fX36AnH6fX19+n19/RJ9fQNrff0SAu59/RJ9fQLuff4MAXf9j30AAAACAAAAAANrA2sADAAZAAATIRcRByMnNTMVMxEhASEnETczFxUjNSMRIX0CcX19fX19ff0SAu79j319fX19fQLuA2t9/ol9ffr6AXf9En0Bd319+vr+iQAAAAAOAK4AAQAAAAAAAAARACQAAQAAAAAAAQANAFIAAQAAAAAAAgAHAHAAAQAAAAAAAwAgALoAAQAAAAAABAAVAQcAAQAAAAAABQAyAYMAAQAAAAAABgAVAeIAAwABBAkAAAAiAAAAAwABBAkAAQAaADYAAwABBAkAAgAOAGAAAwABBAkAAwBAAHgAAwABBAkABAAqANsAAwABBAkABQBkAR0AAwABBAkABgAqAbYAYwBvAHAAeQByAGkAZwBoAHQAIABtAGkAcwBzAGkAbgBnAABjb3B5cmlnaHQgbWlzc2luZwAAUwBoAGUAaQBrAGEAaABHAGwAeQBwAGgAcwAAU2hlaWthaEdseXBocwAAUgBlAGcAdQBsAGEAcgAAUmVndWxhcgAAMQAuADAAMAAwADsAVQBLAFcATgA7AFMAaABlAGkAawBhAGgARwBsAHkAcABoAHMALQBSAGUAZwB1AGwAYQByAAAxLjAwMDtVS1dOO1NoZWlrYWhHbHlwaHMtUmVndWxhcgAAUwBoAGUAaQBrAGEAaABHAGwAeQBwAGgAcwAgAFIAZQBnAHUAbABhAHIAAFNoZWlrYWhHbHlwaHMgUmVndWxhcgAAVgBlAHIAcwBpAG8AbgAgADEALgAwADAAMAA7AGgAbwB0AGMAbwBuAHYAIAAxAC4AMAAuADEAMAA5ADsAbQBhAGsAZQBvAHQAZgBlAHgAZQAgADIALgA1AC4ANgA1ADUAOQA2AABWZXJzaW9uIDEuMDAwO2hvdGNvbnYgMS4wLjEwOTttYWtlb3RmZXhlIDIuNS42NTU5NgAAUwBoAGUAaQBrAGEAaABHAGwAeQBwAGgAcwAtAFIAZQBnAHUAbABhAHIAAFNoZWlrYWhHbHlwaHMtUmVndWxhcgAAAAACAAAAAAAA/4MAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAEYAAAABAAIAAwAEABAAEQATABQAFQAWABcAGAAZABoAGwAcACIAJAAlACYAJwAoACkAKgArACwALQAuAC8AMAAxADIAMwA0ADUANgA3ADgAOQA6ADsAPAA9AEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgBbAFwAXQAAAAAAAf//AAIAAQAAAAwAAAAWAAAAAgABAAMARQABAAQAAAACAAAAAAAAAAEAAAAA2t7XxQAAAADYzvD7AAAAANjO8Ps=") format("truetype");
    }

    .sheikah-glyph {
      font-family: "SheikahGlyphs", Arail sans-serif !important;
      speak: none;
      font-style: normal;
      font-weight: normal;
      font-variant: normal;
      text-transform: none;
      line-height: inherit;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  `

  function replaceGlyphs() {
    const elements = doc.querySelectorAll(SELECTOR)

    elements.forEach(element => {
      element.childNodes.forEach(node => {
        if (node.nodeType !== Node.TEXT_NODE) return
        const originalText = node.textContent
        const newText = originalText
          .split('')
          .map(char =>
            SHEIKAH_GLYPHS.includes(char.toLowerCase())
              ? `<span class="sheikah-glyph" title="${char.toLowerCase()}">${char.toLowerCase()}</span>`
              : char,
          )
          .join('')
        if (originalText === newText) return
        const newTextNode = doc.createElement('span')
        newTextNode.innerHTML = newText
        node.replaceWith(newTextNode)
      })
      element.classList.add('sheikah-glyphs-rendered')
    })
  }

  function observeDOM(observer) {
    observer.observe(doc.body, { childList: true, subtree: true })
  }

  function debounce(func, wait, immediate) {
    let timeout
    return function (...args) {
      const context = this
      const later = function () {
        timeout = null
        if (!immediate) func.apply(context, args)
      }
      const callNow = immediate && !timeout
      clearTimeout(timeout)
      timeout = setTimeout(later, wait)
      if (callNow) func.apply(context, args)
    }
  }

  function injectStyle() {
    const style = doc.createElement('style')
    style.innerHTML = CSS
    doc.head.append(style)
  }

  const replaceGlyphsDebounced = debounce(replaceGlyphs, 300)

  // script loaded
  replaceGlyphs()

  // content changed
  const observer = new MutationObserver(() => {
    requestAnimationFrame(replaceGlyphsDebounced)
  })

  if (doc.readyState === 'loading') {
    doc.addEventListener('DOMContentLoaded', () => {
      observeDOM(observer)
      injectStyle()
    })
  } else {
    observeDOM(observer)
    injectStyle()
  }
})()
